---
layout: post
status: publish
published: true
title: Клиент-сервер калькулятор
author: ––=Messiλh=––
author_login: Messiah
author_email: m.muzafarov@gmail.com
author_url: http://m.muzafarov.vk.com
excerpt: "Задачка из курса Распределённых Объектных технологий.\r\n\r\nНаписано на
  чистых сокетах, интерактивно.\r\n\r\n"
wordpress_id: 239
wordpress_url: http://messiah.ks8.ru/?p=239
date: 2013-09-13 13:18:27.000000000 +06:00
categories:
- Python
tags: []
comments: []
---
Задачка из курса Распределённых Объектных технологий.

Написано на чистых сокетах, интерактивно.

<a id="more"></a><a id="more-239"></a>

Клиент считывает ввод и отправляет серверу, сервер считает, возвращает ответ.

<strong>Код сервера:<&#47;strong>
<pre class="brush: python; gutter: true">#!&#47;usr&#47;bin&#47;python3
# -*- coding: utf-8 -*-
import socket

HOST = &#039;&#039;
PORT = 27001
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind((HOST, PORT))
s.listen(5)
while True:
    conn, addr = s.accept()
    print(&#039;Connected by&#039;, addr)
    while True:
        data = ""
        c = &#039;&#039;
        while c != &#039;\n&#039;:
            c = conn.recv(1).decode()
            if c:
                data += c
            else:
                break
        if data and data != "quit\n":
            try:
                message = "{}\n".format(eval(data.strip()))
            except Exception as e:
                message = "Invalid input\n"
            conn.sendall(message.encode())
        else:
            break
    conn.close()<&#47;pre>
<strong>Код клиента:<&#47;strong>
<pre class="brush: python; gutter: true">#!&#47;usr&#47;bin&#47;python3
# -*- coding: utf-8 -*-
import sys
import socket

class Client(object):
    def __init__(self, host, port):
        self.host = host
        self.port = port

    def connect(self):
        self.sock = socket.create_connection((self.host, self.port))

    def send_request(self, req):
        return self.sock.send("{}\n".format(req).encode())

    def get_reply(self):
        recv = self.sock.recv(512)
        return recv.decode()

def print_help(argv):
    usage = "Usage: {0} host port".format(argv[0])
    print(usage)

def main():
    if len(sys.argv) != 3:
        print_help(sys.argv)
        sys.exit(1)
    host, port = sys.argv[1:3]
    client = Client(host, port)
    client.connect()
    while True:
        req = input("Client> ")
        client.send_request(req)
        if req == "quit":
            break
        print("Server> {0}".format(client.get_reply().strip()))

if __name__ == "__main__":
    main()<&#47;pre>
Запуск клиента:
<pre class="brush: bash; gutter: false">python client.py host port &nbsp; # в сервере порт 27001<&#47;pre>

<a href="https:&#47;&#47;github.com&#47;m-muzafarov&#47;ROT&#47;tree&#47;master&#47;Task1"><img src="http:&#47;&#47;messiah.ks8.ru&#47;wp-content&#47;uploads&#47;github-button.png" alt="github-button" width="170" height="72" class="alignleft size-full wp-image-258" &#47;><&#47;a>
