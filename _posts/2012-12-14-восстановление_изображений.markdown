---
layout: post
status: publish
published: true
title: Восстановление изображений
author: M_Messiah
author_login: Messiah
author_email: m.muzafarov@gmail.com
author_url: http://brainstorage.me/M_Messiah
excerpt: "Восстановление изображений и фильтры"
date: 2012-12-14 14:09:14.000000000 +06:00
categories: Images
tags: []
comments: true
---

**Восстановление**

f - нормальное изображение, f&#770; - восстановленное.

Есть много способов восстановить.



1 способ: 

| f - f&#770; |<sub>L<sub>2</sub></sub> -> min

Предположим, g(x) = f * g + n

## Вероятностная модель искажения изображения ##
Случайные величины - яркости пикселя. *(256-ти уровневая шкала)*

***Случайное поле*** - случайная функция нескольких переменных.

1.	Исходное изображение -&nbsp;**случайное поле**.
2.	n - случайное поле, с ограничением:
	1.	M(n)=0 (матожидание)
3.	f и n - не коррелируют между собой, то есть M(f<sub>n</sub>)=0

f -> F

Известна формула: &int; f&sup2; dxdy = &int; | F |&sup2; dxdy

Искажение: g = h * f + n

Нужно найти фильтр &#7529;, который поможет уменьшить искажение.

Чтобы задачу можно было решить в каком-то конечном виде, определим класс восстанавливающих фильтров. Пусть класс будет такой же - инвариантных от сдвига.

Будем искать &#7529;&#770; = &#7529; * g

То есть, найти такую &#7529;, что D( &#7529; * (h * f + n) - f) -> min

Эту задачу решает **фильтр Винера**

Всё делаем в частотной области.

На входе имеем:

G = F H + N (это уже комплекснозначные спектры, тут нормальное обычное произведение комплексных чисел)

Предположения:

1.	&int; N = 0
2.	&int; F N = 0

Тогда ищем F&#770; = &Phi; G - передаточная функция Винера

&int; (F&#770; - F)(F&#770;&#772; - F&#772;) -> min<sub>&Phi;</sub>

Введем скалярную вариацию R: &Phi; = &Phi;<sub>0</sub> + &tau; R

Подставим &Phi;<sub>0</sub> в нашу формулу и сделаем её зависимой от скалярного аргумента :&forall; R: D<sub>i</sub>(..) -> min<sub>&Phi;<sub>i</sub></sub>

![Viner filter](/img/viner_filter.svg) - фильтр Винера.

Ищем такое &Phi;<sub>0</sub> что ![Viner filter](/img/viner_filter.svg) &forall;R

Задача выпуклая и всё клёво получается.

![Viner Task](/img/viner_task.svg)

Дифференцируем интеграл:

![Viner Task Diff](/img/viner_task1.svg)

И подставляем получившееся произведение и приравниваем:

&int; (G&sup2;(&Phi;<sub>&tau;</sub>R&#772; + &Phi;&#772;<sub>&tau;</sub>R) - GF&#772;R - G&#772;FR) |<sub>&tau; = 0</sub> = 0

G&sup2; = (FH + N)(F&#772;H + N&#772;) = F&sup2;H&sup2; + F&#772;HN + FHN&#772; + N&sup2;

GF = F&sup2;H + NF, NF - можно опустить, так как они для любого R должны давать ноль. Это только когда они сами ноль.

G&#772;F = F&sup2;H&#772; + N&#772;F

R<sup> * </sup>(&Phi;(F&sup2;H&sup2; + N&sup2;) - F&sup2;H<sup> * </sup>) + RW<sup> * </sup>, где W - скобка при R<sup> * </sup>

В итоге достаточно найти, когда W=0

&Phi;<sub>0</sub>(F&sup2;H&sup2; + N&sup2;) = F&sup2;H<sup>*</sup>


![Viner Filter 1](/img/viner_filter1.svg), но лучше фильтр Винера записать, как ![Viner Filter 2](/img/viner_filter2.svg)

Но на практике это неудобно вааащпе(((( Так как ни шума, ни мощности сигнала не дано. Так что проще заменить отношение сигнала к шуму константой. Хотя удобнее сделать не константу, а что-нибудь поточнее - K(u,v)

Вопрос: Где взять H - ядро искажающего оператора?

На практике есть несколько рекомендаций:

1.	Оценка H по фрагмент{у/ам}:
	G=HF, H=G/F (из участка изображения) Недостатки: искать незашумленный участок, локальность и вообще плохо(( Если ничего нет, тогда можно.
2.	На основе экспериментов
3.	На основе матмоделирования. (годится для построения фильтра для смаза).

Если экспозиция не мгновенная, а в промежутке [0,T] - стопудово смаз будет. Пусть аппарат проходит за это время плоский путь (x(t),y(t))

Если смаз параллельный:

![Smaz](/img/model_smaz.svg) - модель смаза.

Что здесь H? Цель: G~HF

Строим обратное преобразование Фурье:

![Reverse Furie](/img/reverse_furie.svg)

G=FH+N

Если N- мало, N-простое, то можно F=G/H

Если H где-то обращается в 0 или другие проблемы, то ![Viner Task 6](/img/viner_task6.svg)

