---
layout: post
status: publish
published: true
title: Восстановление изображений
author: M_Messiah
author_login: Messiah
author_email: m.muzafarov@gmail.com
author_url: http://m.muzafarov.vk.com
excerpt: "**Восстановление**\r\n\r\nf - нормальное изображение, $latex
  \\hat{f}$ - восстановленное.\r\n\r\nЕсть много способов восстановить.\r\n\r\n"
wordpress_id: 227
wordpress_url: http://messiah.ks8.ru/?p=227
date: 2012-12-14 14:09:14.000000000 +06:00
categories:
- Обработка изображений
tags: []
comments: []
---
**Восстановление**

f - нормальное изображение, $latex \hat{f}$ - восстановленное.

Есть много способов восстановить.



1 способ: 

$$
|f-\hat{f}{|}_{L_2}->min
$$

Предположим, $latex g(x)=f*g+n$
## Вероятностная модель искажения изображения ##
Случайные величины - яркости пикселя. * (256-ти уровневая шкала) *

* **Случайное поле** * - случайная функция нескольких переменных.
<ol>
	<li>Исходное изображение -&nbsp;**случайное поле**.</li>
	<li>n - случайное поле, с ограничением:
<ol>
	<li>M(n)=0 (матожидание)</li>
</ol>
</li>
	<li>f и n - не коррелируют между собой, то есть M(fn)=0</li>
</ol>
$latex f -> F$

Известна формула:&nbsp;$latex \int f^2 dxdy = \int {|F|}^2dxdy $

Искажение: $latex g=h*f + n$

Нужно найти фильтр $latex \varphi$, который поможет уменьшить искажение.

Чтобы задачу можно было решить в каком-то конечном виде, определим класс восстанавливающих фильтров. Пусть класс будет такой же - инвариантных от сдвига.

Будем искать $latex \hat{\varphi} = \varphi * g $

То есть, найти такую $latex \varphi$, что $latex D(\varphi *(h*f+n)-f)->min$

Эту задачу решает **фильтр Винера.**

Всё делаем в частотной области.

На входе имеем:

G=FH+N &nbsp;(это уже комплекснозначные спектры, тут нормальное обычное произведение комплексных чисел)

Предположения:
<ol>
	<li>&nbsp;$latex \int N =0$</li>
	<li>&nbsp;$latex \int FN =0$</li>
</ol>
Тогда ищем $latex \hat{F} = \Phi G $ - передаточная функция Винера

$latex \int (\hat{F}-F)(\bar{\hat{F}}-\bar{F}) -> min_{\Phi} $

Введем скалярную вариацию R: $latex \Phi=\Phi_0+\tau R$

Подставим $latex \Phi_o $ в нашу формулу и сделаем её зависимой от скалярного аргумента : $latex \forall R:D_i(..) -> {min}_{\Phi_i} $

$latex \frac{dD}{d\tau} = 0$ - фильтр Винера.

Ищем такое $latex \Phi_0$ что $latex \frac{dD}{d\tau}=0, \forall R$

Задача выпуклая и всё клёво получается.

$latex D=\int (\Phi_\tau G-F)(\bar{\Phi_\tau G}-\bar{F}) =\int({\Phi_\tau}^2G^2-F\bar{\Phi_\tau}\bar{G}-\bar{F}\Phi_\tau G+F^2)->{min}_{\tau}$

Дифференцируем интеграл:

$latex \frac{d\Phi_\tau}{d\tau}=R, \frac{d\bar{\Phi_\tau}}{d\tau}=\bar{R}, \frac{d\Phi_\tau}{d\tau}=\Phi_\tau\bar{R}+\bar{\Phi_\tau}R$

И подставляем получившееся произведение и приравниваем:

$latex \int(G^2(\Phi_\tau\bar{R}+\bar{\Phi_\tau}R)-G\bar{F}R-\bar{G}FR) {|}_{\tau=0} =0.$

$latex G^2=(FH+N)(\bar{FH}+\bar{N})=F^2H^2+\bar{FH}N+FH\bar{N}+N^2$

$latex GF=F^2H+NF$ NF - можно опустить, так как они для любого R должны давать ноль. Это только когда они сами ноль.

$latex \bar{G}F=F^2\bar{H}+\bar{N}F$

$latex R^{*}(\Phi(F^2H^2+N^2)-F^2H^{*})+RW^{*} =0$, где W - скобка при $latex R^{*}$

В итоге достаточно найти, когда W=0

$latex \Phi_0(F^2H^2+N^2)=F^2H^{*} $

&nbsp;

$latex \Phi_0=\frac{H^{*}}{|H^2|+\frac{|W|^2}{|F|^2}}$, но лучше фильтр Винера записать, как $latex \Phi_0=\frac{H^{*}}{|H|^2+\frac{P_n}{P_f}}$

Но на практике это неудобно вааащпе(((( &nbsp;Так как ни шума, ни мощности сигнала не дано. Так что проще заменить отношение сигнала к шуму константой. Хотя удобнее сделать не константу, а что-нибудь поточнее - K(u,v)

Вопрос: Где взять H - ядро искажающего оператора?

На практике есть несколько рекомендаций:
<ol>
	<li>Оценка H по фрагмент{у/ам}:
G=HF, H=G/F (из участка изображения) Недостатки: искать незашумленный участок, локальность и вообще плохо(( Если ничего нет, тогда можно.</li>
	<li>На основе экспериментов</li>
	<li>На основе матмоделирования. (годится для построения фильтра для смаза).</li>
</ol>
Если экспозиция не мгновенная, а в промежутке [0,T] - стопудово смаз будет. Пусть аппарат проходит за это время плоский путь (x(t),y(t))

Если смаз параллельный:

$latex g(x,y)=\int\limits_{0}^{T}f(x-x(t),y-y(t))dt$ - модель смаза.

Что здесь H? Цель: G~HF

Строим обратное преобразование Фурье:

$latex G=\int\int g e^{-i2\pi(xu+yv)}dxdy=F(u,v)\int\limits_{0}^{T}edt $

G=FH+N

Если N- мало, N-простое, то можно F=G/H

Если H где-то обращается в 0 или другие проблемы, то $latex \Phi=\frac{\bar{H}}{H^2+\frac{N^2}{F^2}}$

&nbsp;
